// In deiner HTML, ersetze die sendMessage Funktion:
async function sendMessage() {
    const query = userInput.value.trim();
    if (!query) return;
    
    sendButton.disabled = true;
    userInput.disabled = true;
    
    const userMessageDiv = document.createElement('div');
    userMessageDiv.className = 'message user-message';
    userMessageDiv.textContent = query;
    chatMessages.appendChild(userMessageDiv);
    userInput.value = '';
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'message bot-message';
    loadingDiv.textContent = 'üßò‚Äç‚ôÄÔ∏è Suche nach passenden Asanas...';
    chatMessages.appendChild(loadingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    try {
        const response = await fetch('/api/chat', { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify({ query }),
            timeout: 30000 // 30 Sekunden Timeout
        });
        
        if (!response.ok) {
            const errorResult = await response.json();
            throw new Error(errorResult.message || 'Serverfehler');
        }
        
        const result = await response.json();
        loadingDiv.innerHTML = result.reply; // Kein marked.parse n√∂tig, da HTML zur√ºckkommt
        
    } catch (error) {
        console.error('Frontend Error:', error);
        loadingDiv.innerHTML = `‚ùå Verbindungsfehler: Bitte versuche es erneut.`;
    } finally {
        sendButton.disabled = false;
        userInput.disabled = false;
        userInput.focus();
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}
